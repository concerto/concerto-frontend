<!--
The `concerto-content` elements provides a base element to be extended when
building specific Concerto content elements.

@element concerto-content
@status alpha
-->
<polymer-element name="concerto-content" attributes="contentId title duration autoLoad baseURL cssText">
  <template>
    <style>
      :host {
        position: absolute;
      }
    </style>
  </template>

  <script>
    Polymer({
      /**
       * The `load` event is fired when the content is loaded and ready to be
       * displayed.  By default this happens in `domReady`.
       *
       * @event load
       */

      /**
       * Backend ID of the content.
       *
       * @attribute contentId
       * @type Number
       * @default 0
       */
       contentId: 0,

      /**
       * Title of the content.
       *
       * @attribute title
       * @type String
       * @default ''
       */
       title: '',

      /**
       * Duration the content should be displayed for, in seconds.
       *
       * @attribute duration
       * @type Number
       * @default 0
       */
       duration: 0,

      /**
       * Control if the `load` event is automatically fired or not when the
       * `domReady` and `fromJSON` methods are called.
       *
       * @attribute autoLoad
       * @type Boolean
       * @default true
       */
       autoLoad: true,

      /**
       * CSS styling information to be set on the content.
       *
       * @attribute cssText
       * @type String
       * @default ''
       */
      cssText: '',

      /**
       * Base path to prepend to all URLs.
       *
       * @attribute baseURL
       * @type String
       * @default ''
       */
      baseURL: '',

      /**
       * When the dom is ready, call `loaded` to say everything has loaded.
       */
      domReady: function() {
        if (this.autoLoad) {
          this.loaded();
        }
      },

      /**
       * Indicate that this content has finished loaded and can be displayed
       * in the field.
       *
       * Currently this involves firing the `load` event, but the details may
       * change.
       */
      loaded: function() {
        this.fire('load', this);
      },

      /**
       * Load the values from a JSON Map which map to attributes
       * of this element.
       */
      fromJSON: function(data) {
        Object.keys(data).forEach(function(key) {
          if (key in this) {
            if (typeof data[key] == 'object') {
              this.setAttribute(key, JSON.stringify(data[key]));
            } else {
              this.setAttribute(key, data[key]);
            }
          }
        }.bind(this));
        if (this.autoLoad) {
          this.loaded();
        }
      },

      /**
       * Apply the new cssText back to the element.
       *
       * Different content types should override this method to set the styl on
       * a more appropriate DOM element.
       */
      cssTextChanged: function() {
        this.style.cssText = this.cssText;
       },
    });
  </script>
</polymer-element>
<script>
  /**
   * Register the content type described by the current page in the
   * ContentFactory.
   *
   * This method should be called from each piece of content which inherits from
   * concerto-content. It attempts to automatically determine what Polymer
   * element is being defined and setup an event listener to register it once
   * Polymer has finished loading all elements.
   */
  function registerContentType(contentName, klass){
    window.addEventListener('polymer-ready', function(){
      if (concerto && concerto.contentFactory) {
        // concerto-ticker should be known as ticker.
        var name = contentName.replace(/^concerto-/, '');
        concerto.contentFactory.registerType(name, window[klass]);
      }
    });
  }
</script>